(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{5852:function(e,r,a){Promise.resolve().then(a.t.bind(a,4671,23)),Promise.resolve().then(a.t.bind(a,3054,23)),Promise.resolve().then(a.bind(a,2017))},2017:function(e,r,a){"use strict";a.d(r,{Providers:function(){return f}});var t=a(7437),o=a(1444),n=a(6862),i=a(7594);let u=(0,n.xC)({reducer:{auth:i.ZP}});var l=a(8726),s=a(2265);function d(){let e=(0,o.I0)();return(0,s.useEffect)(()=>{e((0,i.uJ)())},[e]),null}var c=a(4137);function f(e){let{children:r}=e;return(0,t.jsxs)(o.zt,{store:u,children:[(0,t.jsx)(d,{}),(0,t.jsx)(l.x7,{position:"top-right"}),(0,t.jsx)(c.J,{children:r})]})}},4137:function(e,r,a){"use strict";a.d(r,{J:function(){return l},z:function(){return s}});var t=a(7437),o=a(2265),n=a(7048);let i={getNotifications:async e=>(await fetch("/api/notifications",{headers:{"x-user-id":e}})).json(),markRead:async(e,r,a)=>fetch("/api/notifications",{method:"PUT",headers:{"x-user-id":e,"Content-Type":"application/json"},body:JSON.stringify({notificationId:r,markAll:a})})},u=(0,o.createContext)(void 0);function l(e){let{children:r}=e,{currentUser:a}=(0,n.a)(),[l,s]=(0,o.useState)([]),[d,c]=(0,o.useState)(0),[f,p]=(0,o.useState)(!1),g=async()=>{if(null==a?void 0:a.uid)try{let e=await i.getNotifications(a.uid);s(e.notifications),c(e.unreadCount)}catch(e){console.error("Failed to fetch notifications",e)}},h=async e=>{if(null==a?void 0:a.uid)try{e&&(s(r=>r.map(r=>r._id===e?{...r,read:!0}:r)),c(e=>Math.max(0,e-1)),await i.markRead(a.uid,e))}catch(e){console.error("Failed to mark as read",e),g()}},y=async()=>{if(null==a?void 0:a.uid)try{s(e=>e.map(e=>({...e,read:!0}))),c(0),await i.markRead(a.uid,void 0,!0)}catch(e){console.error("Failed to mark all as read",e),g()}};return(0,o.useEffect)(()=>{if(null==a?void 0:a.uid){g();let e=setInterval(g,3e4);return()=>clearInterval(e)}s([]),c(0)},[null==a?void 0:a.uid]),(0,t.jsx)(u.Provider,{value:{notifications:l,unreadCount:d,loading:f,refreshNotifications:g,markAsRead:h,markAllAsRead:y},children:r})}function s(){let e=(0,o.useContext)(u);if(void 0===e)throw Error("useNotifications must be used within a NotificationProvider");return e}},7048:function(e,r,a){"use strict";a.d(r,{a:function(){return n}});var t=a(1444),o=a(7594);function n(){let e=(0,t.I0)(),{currentUser:r,loading:a,error:n}=(0,t.v9)(e=>e.auth);return{currentUser:r,loading:a,error:n,register:(r,a,t)=>e((0,o.z2)({email:r,password:a,name:t})),login:(r,a)=>e((0,o.x4)({email:r,password:a})),loginWithGoogle:()=>e((0,o.Cb)()),logout:()=>e((0,o.kS)()),updateUserProfile:r=>e((0,o.Lj)(r))}}},7594:function(e,r,a){"use strict";a.d(r,{ZP:function(){return x},uJ:function(){return f},x4:function(){return g},Cb:function(){return h},kS:function(){return y},z2:function(){return p},Lj:function(){return m}});var t=a(6862),o=a(5735),n=a(5236),i=a(9854);let u=(0,n.ZF)({apiKey:"AIzaSyCGhp1cC_bCwRHFzSrI3yTDJ9LOOlZy1i4",authDomain:"explokar-a27aa.firebaseapp.com",projectId:"explokar-a27aa",storageBucket:"explokar-a27aa.firebasestorage.app",messagingSenderId:"672347253575",appId:"1:672347253575:web:24ab4e1304c83a01277a62"}),l=(0,o.v0)(u);(0,i.cF)(u);var s=a(8472),d=a(8726);let c=e=>({uid:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL}),f=(0,t.hg)("auth/initialize",async(e,r)=>{let{dispatch:a}=r;return new Promise(e=>{let r=(0,o.Aj)(l,t=>{a(w(t?c(t):null)),r(),e()})})}),p=(0,t.hg)("auth/register",async(e,r)=>{let{email:a,password:t,name:n}=e,{rejectWithValue:i}=r;try{let e=await (0,o.Xb)(l,a,t);return await (0,o.ck)(e.user,{displayName:n}),await s.Z.post("/api/auth",{uid:e.user.uid,email:e.user.email,name:n,photoURL:e.user.photoURL||""}),c(e.user)}catch(e){return console.error("Error during registration:",e),d.ZP.error(e.message),i(e.message)}}),g=(0,t.hg)("auth/login",async(e,r)=>{let{email:a,password:t}=e,{rejectWithValue:n}=r;try{let e=await (0,o.e5)(l,a,t);return c(e.user)}catch(e){return console.error("Error during login:",e),d.ZP.error(e.message),n(e.message)}}),h=(0,t.hg)("auth/loginWithGoogle",async(e,r)=>{let{rejectWithValue:a}=r;try{let e=new o.hJ,r=await (0,o.rh)(l,e);try{await s.Z.post("/api/auth",{uid:r.user.uid,email:r.user.email,name:r.user.displayName,photoURL:r.user.photoURL||""})}catch(e){console.log("User might already exist in the database.")}return c(r.user)}catch(e){return"auth/popup-blocked"===e.code?await (0,o.F6)(l,new o.hJ):(console.error("Error during Google login:",e),d.ZP.error(e.message)),a(e.message)}}),y=(0,t.hg)("auth/logout",async(e,r)=>{let{rejectWithValue:a}=r;try{await (0,o.w7)(l),d.ZP.success("Successfully logged out")}catch(e){return console.error("Error during logout:",e),d.ZP.error("Failed to log out"),a(e.message)}}),m=(0,t.hg)("auth/updateProfile",async(e,r)=>{let{getState:a,rejectWithValue:t}=r;a();let n=l.currentUser;if(!n)return t("No user logged in");try{return await (0,o.ck)(n,e),await s.Z.put("/api/auth/".concat(n.uid),{name:e.displayName,photoURL:e.photoURL}),d.ZP.success("Profile updated successfully"),e}catch(e){return console.error("Error updating profile:",e),d.ZP.error("Failed to update profile"),t(e.message)}}),v=(0,t.oM)({name:"auth",initialState:{currentUser:null,loading:!0,error:null},reducers:{setUser:(e,r)=>{e.currentUser=r.payload,e.loading=!1},setLoading:(e,r)=>{e.loading=r.payload},clearError:e=>{e.error=null}},extraReducers:e=>{e.addCase(p.pending,e=>{e.loading=!0,e.error=null}).addCase(p.fulfilled,(e,r)=>{e.currentUser=r.payload,e.loading=!1}).addCase(p.rejected,(e,r)=>{e.error=r.payload,e.loading=!1}).addCase(g.pending,e=>{e.loading=!0,e.error=null}).addCase(g.fulfilled,(e,r)=>{e.currentUser=r.payload,e.loading=!1}).addCase(g.rejected,(e,r)=>{e.error=r.payload,e.loading=!1}).addCase(h.pending,e=>{e.loading=!0,e.error=null}).addCase(h.fulfilled,(e,r)=>{e.currentUser=r.payload,e.loading=!1}).addCase(h.rejected,(e,r)=>{e.error=r.payload,e.loading=!1}).addCase(y.fulfilled,e=>{e.currentUser=null}).addCase(m.fulfilled,(e,r)=>{e.currentUser&&(e.currentUser={...e.currentUser,...r.payload})})}}),{setUser:w,setLoading:C,clearError:U}=v.actions;var x=v.reducer},3054:function(){},4671:function(e){e.exports={style:{fontFamily:"'__Inter_f367f3', '__Inter_Fallback_f367f3'",fontStyle:"normal"},className:"__className_f367f3"}}},function(e){e.O(0,[93,139,18,344,971,23,744],function(){return e(e.s=5852)}),_N_E=e.O()}]);