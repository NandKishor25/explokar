"use strict";(()=>{var e={};e.id=776,e.ids=[776,744,298],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},56676:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>q,patchFetch:()=>x,requestAsyncStorage:()=>y,routeModule:()=>g,serverHooks:()=>f,staticGenerationAsyncStorage:()=>S});var n={};r.r(n),r.d(n,{PUT:()=>m,dynamic:()=>c});var i=r(49303),s=r(88716),a=r(60670),o=r(87070),d=r(75748),u=r(13744),p=r(5056),l=r(10298);let c="force-dynamic";async function m(e,{params:t}){try{let r=e.headers.get("x-user-id");if(!r)return o.NextResponse.json({message:"Unauthorized"},{status:401});await (0,d.Z)();let{status:n}=await e.json();if(!["accepted","rejected"].includes(n))return o.NextResponse.json({message:"Invalid status"},{status:400});let i=await u.default.findById(t.id);if(!i)return o.NextResponse.json({message:"Request not found"},{status:404});if("pending"!==i.status)return o.NextResponse.json({message:"Request already processed"},{status:400});let s=await p.Z.findById(i.tripId);if(!s)return o.NextResponse.json({message:"Trip not found"},{status:404});if(s.userId!==r)return o.NextResponse.json({message:"Unauthorized"},{status:403});i.status=n,await i.save(),"accepted"===n&&(s.participants.push({userId:i.userId,name:i.userName,photoURL:i.userPhoto}),await s.save());try{await l.default.create({recipient:i.userId,sender:{userId:s.userId,name:"System",photoURL:""},type:"accepted"===n?"REQUEST_ACCEPTED":"REQUEST_DECLINED",tripId:s._id,message:`Your request to join "${s.title}" was ${n}`,read:!1})}catch(e){console.error("Error sending notification to requester",e)}return o.NextResponse.json({message:`Request ${n}`},{status:200})}catch(e){return console.error("Error updating request:",e),o.NextResponse.json({message:"Server error"},{status:500})}}let g=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/requests/[id]/route",pathname:"/api/requests/[id]",filename:"route",bundlePath:"app/api/requests/[id]/route"},resolvedPagePath:"/Users/guidertechnologies/Downloads/explokar-main 2/src/app/api/requests/[id]/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:y,staticGenerationAsyncStorage:S,serverHooks:f}=g,q="/api/requests/[id]/route";function x(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:S})}},75748:(e,t,r)=>{r.d(t,{Z:()=>o});var n=r(11185),i=r.n(n);let s=process.env.MONGODB_URI||"mongodb://localhost:27017/explokar";if(!s)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let a=global.mongoose;a||(a=global.mongoose={conn:null,promise:null});let o=async function(){if(a.conn)return a.conn;a.promise||(a.promise=i().connect(s,{bufferCommands:!1}).then(e=>e.connection));try{a.conn=await a.promise}catch(e){throw a.promise=null,e}return a.conn}},13744:(e,t,r)=>{r.r(t),r.d(t,{default:()=>a});var n=r(11185),i=r.n(n);let s=new n.Schema({tripId:{type:String,required:!0,index:!0},userId:{type:String,required:!0,index:!0},userName:{type:String,required:!0},userPhoto:{type:String},status:{type:String,enum:["pending","accepted","rejected"],default:"pending"},message:{type:String,required:!0}},{timestamps:!0});s.index({tripId:1,userId:1},{unique:!0});let a=i().models.JoinRequest||i().model("JoinRequest",s)},10298:(e,t,r)=>{r.r(t),r.d(t,{default:()=>a});var n=r(11185),i=r.n(n);let s=new n.Schema({recipient:{type:String,required:!0,index:!0},sender:{userId:{type:String,required:!0},name:{type:String,required:!0},photoURL:{type:String}},type:{type:String,enum:["TRIP_JOIN","MESSAGE","TRIP_LEAVE","SYSTEM","JOIN_REQUEST","REQUEST_ACCEPTED","REQUEST_DECLINED"],required:!0},tripId:{type:String},relatedId:{type:String},message:{type:String,required:!0},read:{type:Boolean,default:!1},createdAt:{type:Date,default:Date.now}});s.index({recipient:1,createdAt:-1});let a=i().models.Notification||i().model("Notification",s)},5056:(e,t,r)=>{r.d(t,{Z:()=>a});var n=r(11185),i=r.n(n);let s=new n.Schema({title:{type:String,required:!0},startLocation:{type:String,required:!0},destination:{type:String,required:!0},startDate:{type:Date,required:!0},duration:{type:Number,required:!0},maxParticipants:{type:Number,required:!0},preferredGender:{type:String,enum:["male","female","any"],default:"any"},transportMode:{type:String,enum:["flight","train","car","bus","bike",""],default:""},description:{type:String,required:!0},budget:{type:Number},activities:{type:String},imageUrl:{type:String},imagePublicId:{type:String},userId:{type:String,required:!0},participants:[{userId:String,name:String,photoURL:String}],startLocationCoords:{lat:Number,lng:Number},destinationCoords:{lat:Number,lng:Number},createdAt:{type:Date,default:Date.now}});s.index({title:"text",startLocation:"text",destination:"text",description:"text",activities:"text"});let a=i().models.Trip||i().model("Trip",s)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,972],()=>r(56676));module.exports=n})();