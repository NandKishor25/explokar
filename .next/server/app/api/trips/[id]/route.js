"use strict";(()=>{var e={};e.id=254,e.ids=[254],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},71017:e=>{e.exports=require("path")},63477:e=>{e.exports=require("querystring")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},20965:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>b,patchFetch:()=>v,requestAsyncStorage:()=>x,routeModule:()=>f,serverHooks:()=>h,staticGenerationAsyncStorage:()=>S});var i={};r.r(i),r.d(i,{DELETE:()=>y,GET:()=>c,PUT:()=>g});var a=r(49303),n=r(88716),o=r(60670),s=r(87070),u=r(75748),d=r(5056),p=r(36713),l=r(75153),m=r(49788);async function c(e,{params:t}){try{await (0,u.Z)();let e=await d.Z.findById(t.id);if(!e)return s.NextResponse.json({message:"Trip not found"},{status:404});let r=await p.Z.findOne({uid:e.userId}),i={...e.toObject(),createdBy:{name:r?r.name:"Unknown",photoURL:r?r.photoURL:"",email:r?r.email:""}};return s.NextResponse.json(i,{status:200})}catch(e){return console.error("Error fetching trip:",e),s.NextResponse.json({message:"Server error"},{status:500})}}async function g(e,{params:t}){try{await (0,u.Z)();let r=await e.formData(),i=r.get("userId"),a=await d.Z.findById(t.id);if(!a)return s.NextResponse.json({message:"Trip not found"},{status:404});if(a.userId!==i)return s.NextResponse.json({message:"Not authorized to update this trip"},{status:403});let n=r.get("image");if(n){a.imagePublicId&&await m.v2.uploader.destroy(a.imagePublicId);let e=await n.arrayBuffer(),t=Buffer.from(e).toString("base64"),r=`data:${n.type};base64,${t}`,i=await m.v2.uploader.upload(r,{resource_type:"auto"});a.imageUrl=i.secure_url,a.imagePublicId=i.public_id}["title","startLocation","destination","startDate","duration","maxParticipants","preferredGender","transportMode","description","budget","activities"].forEach(e=>{let t=r.get(e);null!==t&&(["duration","maxParticipants","budget"].includes(e)?a[e]=parseInt(t):a[e]=t)}),await a.save();let o=await p.Z.findOne({uid:a.userId}),l={...a.toObject(),createdBy:{name:o?o.name:"Unknown",photoURL:o?o.photoURL:"",email:o?o.email:""}};return s.NextResponse.json(l,{status:200})}catch(e){return console.error("Error updating trip:",e),s.NextResponse.json({message:"Server error"},{status:500})}}async function y(e,{params:t}){try{await (0,u.Z)();let e=await d.Z.findById(t.id);if(!e)return s.NextResponse.json({message:"Trip not found"},{status:404});return e.imagePublicId&&await m.v2.uploader.destroy(e.imagePublicId),await l.Z.deleteMany({tripId:e._id}),await d.Z.findByIdAndDelete(t.id),s.NextResponse.json({message:"Trip deleted successfully"},{status:200})}catch(e){return console.error("Error deleting trip:",e),s.NextResponse.json({message:"Server error"},{status:500})}}m.v2.config({cloud_name:process.env.CLOUDINARY_CLOUD_NAME,api_key:process.env.CLOUDINARY_API_KEY,api_secret:process.env.CLOUDINARY_API_SECRET});let f=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/trips/[id]/route",pathname:"/api/trips/[id]",filename:"route",bundlePath:"app/api/trips/[id]/route"},resolvedPagePath:"/Users/guidertechnologies/Downloads/explokar-main 2/src/app/api/trips/[id]/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:x,staticGenerationAsyncStorage:S,serverHooks:h}=f,b="/api/trips/[id]/route";function v(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:S})}},75748:(e,t,r)=>{r.d(t,{Z:()=>s});var i=r(11185),a=r.n(i);let n=process.env.MONGODB_URI||"mongodb://localhost:27017/explokar";if(!n)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let o=global.mongoose;o||(o=global.mongoose={conn:null,promise:null});let s=async function(){if(o.conn)return o.conn;o.promise||(o.promise=a().connect(n,{bufferCommands:!1}).then(e=>e.connection));try{o.conn=await o.promise}catch(e){throw o.promise=null,e}return o.conn}},75153:(e,t,r)=>{r.d(t,{Z:()=>o});var i=r(11185),a=r.n(i);let n=new i.Schema({tripId:{type:a().Schema.Types.ObjectId,ref:"Trip",required:!0},userId:{type:String,required:!0},userName:{type:String,required:!0},userPhoto:{type:String},text:{type:String,required:!0},createdAt:{type:Date,default:Date.now}}),o=a().models.Comment||a().model("Comment",n)},5056:(e,t,r)=>{r.d(t,{Z:()=>o});var i=r(11185),a=r.n(i);let n=new i.Schema({title:{type:String,required:!0},startLocation:{type:String,required:!0},destination:{type:String,required:!0},startDate:{type:Date,required:!0},duration:{type:Number,required:!0},maxParticipants:{type:Number,required:!0},preferredGender:{type:String,enum:["male","female","any"],default:"any"},transportMode:{type:String,enum:["flight","train","car","bus","bike",""],default:""},description:{type:String,required:!0},budget:{type:Number},activities:{type:String},imageUrl:{type:String},imagePublicId:{type:String},userId:{type:String,required:!0},participants:[{userId:String,name:String,photoURL:String}],startLocationCoords:{lat:Number,lng:Number},destinationCoords:{lat:Number,lng:Number},createdAt:{type:Date,default:Date.now}});n.index({title:"text",startLocation:"text",destination:"text",description:"text",activities:"text"});let o=a().models.Trip||a().model("Trip",n)},36713:(e,t,r)=>{r.d(t,{Z:()=>o});var i=r(11185),a=r.n(i);let n=new i.Schema({uid:{type:String,required:!0,unique:!0,index:!0},email:{type:String,required:!0,unique:!0,lowercase:!0,trim:!0,match:[/^\S+@\S+\.\S+$/,"Invalid email format"]},name:{type:String,required:!0,trim:!0},photoURL:{type:String,default:""},bio:{type:String,default:"",maxlength:300},location:{type:String,trim:!0},interests:{type:[String],default:[]},averageRating:{type:Number,default:0},totalReviews:{type:Number,default:0},role:{type:String,enum:["user","admin","guide"],default:"user"},languages:{type:[String],default:[]}},{timestamps:!0}),o=a().models.User||a().model("User",n)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[948,972,788],()=>r(20965));module.exports=i})();